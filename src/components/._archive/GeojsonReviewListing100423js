// src/components/GeojsonReviewListing.js

import createReviewCard from "./card-review.js";

export function createGeojsonReviewsListing(store, map, userCoordinates) {
  if (!store.properties) {
    return '';
  }

  const { 
    best, tag, slug, variant, neuscore, 
    storeType, environment, noiseLevel, parking,
    thumbnail, logo, text, region, categoryType,
  } = store.properties;

  const bests = best || [];
  const title = text || [];
  const tags = tag && tag.length ? tag[0].tags : [];
  const limitedBest03 = tags.slice(0, 3);

  let bestHTML = '';
  limitedBest03.forEach(best => {
    bestHTML += `
      <div class="metadata-tag">
        <span class="metadata-tag-text text01 bold">${best}</span>
      </div>`;
  });

  const cardContainer = document.createElement('div');
  cardContainer.className = 'cards-container';

  const carousel = document.createElement('a');
  carousel.className = 'card-postCarousel-item';
  carousel.href = '/#/'+variant+'/'+slug;
  carousel.rel = 'noopener noreferrer nofollow';
  carousel.target = categoryType + '-${store.sys.id}';
  carousel.onclick = function() {
    mapRoute(userCoordinates, store.geometry.coordinates);
  };

  if (variant === 'reviews') { 
    carousel.className += ' ' + 'listingReviews' + ' ' + 'card-mid-item';
    
    const reviewContentData = {
        thumbnail: thumbnail,
        storeType: storeType,
        environment: environment,
        noiseLevel: noiseLevel,
        parking: parking, 
        logo: logo,
        title: title,
        neuscore: neuscore,
        categoryType: categoryType,
        region: region,
        bestHTML: bestHTML,
        best: best
    };

    const reviewContent = createReviewCard.render(reviewContentData);
    const reviewCarouselItem = generateCarouselItem('Reviewed Cards' + reviewContent);
    cardContainer.appendChild(reviewCarouselItem);
    carousel.appendChild(cardContainer);
  }

  return carousel;
}

function generateCarouselItem(content) {
    const carouselItem = document.createElement('div');
    carouselItem.className = 'card-postCarousel-item-container';
    carouselItem.innerHTML = content;
    return carouselItem;
}
